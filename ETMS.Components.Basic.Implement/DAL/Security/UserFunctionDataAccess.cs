//==================================================================================================
//Version 1.0, auto-generated.
//Generated By running1218
//Date: 2008-9-27 9:48:43.
//==================================================================================================
//==================================================================================================
//This file is generated by CodeGenerator(Ver 2.1)
//==================================================================================================

using System;
using System.Collections.Generic;
using System.Data;

using System.Data.SqlClient;
using ETMS.Utility.Data;

using ETMS.Components.Basic.API.Entity.Security;

namespace ETMS.Components.Basic.Implement.DAL.Security
{
    /// <summary>
    /// 数据访问
    /// </summary>
    public class UserFunctionDataAccess : ETMS.Components.Basic.Implement.DAL.Common.IDataAccess
    {
        private static string SelectSql = @"
  SELECT 
       [UserFunctionID]
      ,[UserID]
      ,[FunctionGroupID]
	  ,b.[GroupCode] AS [FunctionGroupCode]
      ,[FunctionID]
      ,a.[Creator]
      ,a.[CreateTime]
  FROM [Site_UserFunction] a 
 inner join [Site_FunctionGroup] b on a.FunctionGroupID=b.[GroupID]
WHERE 1=1 ";


        #region IDataAccess 成员

        public void Add(object obj)
        {
            UserFunction userFunction = (UserFunction)obj;

            string commandName = "dbo.Pr_Site_UserFunction_Insert";
            #region Parameters
            SqlParameter[] parms = SqlHelperParameterCache.GetCachedParameterSet(ConnectionString.ETMSWrite, commandName);
            if (parms == null)
            {
                parms = new SqlParameter[] {	new SqlParameter("@UserFunctionID", SqlDbType.Int, 4, ParameterDirection.Output, false, 0, 0, String.Empty, DataRowVersion.Default, null),
				
					new SqlParameter("@UserID", SqlDbType.Int),
					new SqlParameter("@FunctionGroupID", SqlDbType.Int),
					new SqlParameter("@FunctionID", SqlDbType.Int),
					new SqlParameter("@Creator", SqlDbType.NVarChar, 50),
					new SqlParameter("@CreateTime", SqlDbType.DateTime)
					};
                SqlHelperParameterCache.CacheParameterSet(ConnectionString.ETMSWrite, commandName, parms);
            }

            parms[1].Value = userFunction.UserID;
            parms[2].Value = userFunction.FunctionGroupID;
            parms[3].Value = userFunction.FunctionID;
            if (userFunction.Creator != null) { parms[4].Value = userFunction.Creator; } else { parms[4].Value = DBNull.Value; }
            parms[5].Value = userFunction.CreateTime;
            #endregion
            SqlHelper.ExecuteNonQuery(ConnectionString.ETMSWrite, CommandType.StoredProcedure, commandName, parms);

            userFunction.UserFunctionID = (Int32)parms[0].Value;
        }

        public void Update(object obj)
        {
            UserFunction userFunction = (UserFunction)obj;

            string commandName = "dbo.Pr_Site_UserFunction_Update";
            #region Parameters
            SqlParameter[] parms = SqlHelperParameterCache.GetCachedParameterSet(ConnectionString.ETMSWrite, commandName);
            if (parms == null)
            {
                parms = new SqlParameter[] {
					new SqlParameter("@UserFunctionID", SqlDbType.Int),
					new SqlParameter("@UserID", SqlDbType.Int),
					new SqlParameter("@FunctionGroupID", SqlDbType.Int),
					new SqlParameter("@FunctionID", SqlDbType.Int),
					new SqlParameter("@Creator", SqlDbType.NVarChar, 50),
					new SqlParameter("@CreateTime", SqlDbType.DateTime)
				};
                SqlHelperParameterCache.CacheParameterSet(ConnectionString.ETMSWrite, commandName, parms);
            }

            parms[0].Value = userFunction.UserFunctionID;
            parms[1].Value = userFunction.UserID;
            parms[2].Value = userFunction.FunctionGroupID;
            parms[3].Value = userFunction.FunctionID;
            if (userFunction.Creator != null) { parms[4].Value = userFunction.Creator; } else { parms[4].Value = DBNull.Value; }
            parms[5].Value = userFunction.CreateTime;
            #endregion
            SqlHelper.ExecuteNonQuery(ConnectionString.ETMSWrite, CommandType.StoredProcedure, commandName, parms);
        }

        public void Delete(object obj)
        {
            UserFunction userFunction = (UserFunction)obj;

            string commandName = "dbo.Pr_Site_UserFunction_Delete";
            #region Parameters
            SqlParameter[] parms = SqlHelperParameterCache.GetCachedParameterSet(ConnectionString.ETMSWrite, commandName);
            if (parms == null)
            {
                parms = new SqlParameter[] {
					new SqlParameter("@UserFunctionID", SqlDbType.Int)
				};
                SqlHelperParameterCache.CacheParameterSet(ConnectionString.ETMSWrite, commandName, parms);
            }

            parms[0].Value = userFunction.UserFunctionID;

            #endregion
            SqlHelper.ExecuteNonQuery(ConnectionString.ETMSWrite, CommandType.StoredProcedure, commandName, parms);
        }

        public object Query(object id)
        {
            Int32 userFunctionID = (int)id;

            string sqlScriptFormat = SelectSql + " AND UserFunctionID={0} ";

            DataTable dt = SqlHelper.ExecuteDataset(ConnectionString.ETMSRead, CommandType.Text, string.Format(sqlScriptFormat, userFunctionID)).Tables[0];
            if (dt.Rows.Count == 0)
                return null;
            return UserFunction.ConvertDataRowToUserFunction(dt.Rows[0]);
        }

        public Object[] Query(string filter)
        {
            string sqlScriptFormat =SelectSql + " {0} order by UserFunctionID " ;

            List<UserFunction> list = new List<UserFunction>();
            foreach (DataRow row in SqlHelper.ExecuteDataset(ConnectionString.ETMSRead, CommandType.Text, string.Format(sqlScriptFormat, filter)).Tables[0].Rows)
            {
                list.Add(UserFunction.ConvertDataRowToUserFunction(row));
            }

            return (Object[])list.ToArray();
        }

        public Object[] Query(int pageIndex, int pageSize, string filter, string orderBy, out int recordCount)
        {
            throw new Exception("The method or operation is not implemented.");
        }

        #endregion
    }
}
