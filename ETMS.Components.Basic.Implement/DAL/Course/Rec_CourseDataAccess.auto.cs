//==================================================================================================
//Version 1.0, auto-generated.
//Generated By zhangyh.
//Date: 2016-11-03 13:14:43.
//==================================================================================================

using System;
using System.Data;

using System.Data.SqlClient;
using ETMS.Utility.Data;
using ETMS.Components.Basic.API.Entity.Course;

namespace ETMS.Components.Basic.Implement.DAL.Course
{
    /// <summary>
    /// 课程表数据访问
    /// </summary>
    public partial class Rec_CourseDataAccess
    {
		/// <summary>
		/// 增加
		/// </summary>
		public void Add(Rec_Course rec_Course)
		{
			string commandName = "dbo.Pr_Recommend_Course_Insert";
			#region Parameters
			SqlParameter[] parms = SqlHelperParameterCache.GetCachedParameterSet(ConnectionString.ETMSWrite, commandName);
			if (parms == null)
			{
                parms = new SqlParameter[] {
					new SqlParameter("@CourseID", SqlDbType.UniqueIdentifier),
                    new SqlParameter("@IsTop", SqlDbType.Bit),
                    new SqlParameter("@Sort", SqlDbType.Int),
                    new SqlParameter("@CreateTime", SqlDbType.DateTime),
                    new SqlParameter("@CreateUserID", SqlDbType.Int),
                    new SqlParameter("@CreateUser", SqlDbType.NVarChar, 128),
                    new SqlParameter("@ModifyTime", SqlDbType.DateTime),
                    new SqlParameter("@ModifyUser", SqlDbType.NVarChar, 128),
                    new SqlParameter("@OrgID", SqlDbType.Int)
					};
				SqlHelperParameterCache.CacheParameterSet(ConnectionString.ETMSWrite, commandName, parms);
			}
			
			parms[0].Value = rec_Course.CourseID;
			parms[1].Value = rec_Course.IsTop;
			parms[2].Value = rec_Course.Sort;
            parms[3].Value = rec_Course.CreateTime;
            parms[4].Value = rec_Course.CreateUserID;
            if (rec_Course.CreateUser != null) { parms[5].Value = rec_Course.CreateUser; } else { parms[5].Value = DBNull.Value; }
            parms[6].Value = rec_Course.ModifyTime;
            if (rec_Course.ModifyUser != null) { parms[7].Value = rec_Course.ModifyUser; } else { parms[7].Value = DBNull.Value; }
            parms[8].Value = rec_Course.OrgID;
            #endregion
            SqlHelper.ExecuteNonQuery(ConnectionString.ETMSWrite, CommandType.StoredProcedure, commandName, parms);
			
		}
		
		/// <summary>
		/// 删除
		/// </summary>
		public void Remove(Guid courseID)
		{
			string commandName = "dbo.Pr_Recommend_Course_Delete";
			#region Parameters
			SqlParameter[] parms = SqlHelperParameterCache.GetCachedParameterSet(ConnectionString.ETMSWrite, commandName);
			if (parms == null)
			{
				parms = new SqlParameter[] {
					new SqlParameter("@CourseID", SqlDbType.UniqueIdentifier)
				};
				SqlHelperParameterCache.CacheParameterSet(ConnectionString.ETMSWrite, commandName, parms);
			}
			
			parms[0].Value = courseID;
			
			#endregion
			SqlHelper.ExecuteNonQuery(ConnectionString.ETMSWrite, CommandType.StoredProcedure, commandName, parms);
		}
		
		/// <summary>
		/// 修改
		/// </summary>
		public void Update(Rec_Course rec_Course)
		{
			string commandName = "dbo.Pr_Recommend_Course_Update";
			#region Parameters
			SqlParameter[] parms = SqlHelperParameterCache.GetCachedParameterSet(ConnectionString.ETMSWrite, commandName);
			if (parms == null)
			{
                parms = new SqlParameter[] {
                    new SqlParameter("@CourseID", SqlDbType.UniqueIdentifier),
                    new SqlParameter("@IsTop", SqlDbType.Bit),
                    new SqlParameter("@Sort", SqlDbType.Int),
                    new SqlParameter("@CreateTime", SqlDbType.DateTime),
                    new SqlParameter("@CreateUserID", SqlDbType.Int),
                    new SqlParameter("@CreateUser", SqlDbType.NVarChar, 128),
                    new SqlParameter("@ModifyTime", SqlDbType.DateTime),
                    new SqlParameter("@ModifyUser", SqlDbType.NVarChar, 128),
                    new SqlParameter("@OrgID", SqlDbType.Int),
                    new SqlParameter("@RecommendID", SqlDbType.UniqueIdentifier)
                };
                SqlHelperParameterCache.CacheParameterSet(ConnectionString.ETMSWrite, commandName, parms);
			}

            parms[0].Value = rec_Course.CourseID;
            parms[1].Value = rec_Course.IsTop;
            parms[2].Value = rec_Course.Sort;
            parms[3].Value = rec_Course.CreateTime;
            parms[4].Value = rec_Course.CreateUserID;
            if (rec_Course.CreateUser != null) { parms[5].Value = rec_Course.CreateUser; } else { parms[5].Value = DBNull.Value; }
            parms[6].Value = rec_Course.ModifyTime;
            if (rec_Course.ModifyUser != null) { parms[7].Value = rec_Course.ModifyUser; } else { parms[7].Value = DBNull.Value; }
            parms[8].Value = rec_Course.OrgID;
            parms[9].Value = rec_Course.RecommendID;
            #endregion
            SqlHelper.ExecuteNonQuery(ConnectionString.ETMSWrite, CommandType.StoredProcedure, commandName, parms);
		}
		
		/// <summary>
		/// 根据标识获取对象
		/// </summary>
		public Rec_Course GetById(Guid courseID)
		{
			Rec_Course rec_Course = null;
			
			string commandName = "dbo.Pr_Recommend_Course_GetByPk";
			#region Parameters
			SqlParameter[] parms = SqlHelperParameterCache.GetCachedParameterSet(ConnectionString.ETMSRead, commandName);
			if (parms == null)
			{
				parms = new SqlParameter[] {
					new SqlParameter("@CourseID", SqlDbType.UniqueIdentifier)
				};
				SqlHelperParameterCache.CacheParameterSet(ConnectionString.ETMSRead, commandName, parms);
			}
			
			parms[0].Value = courseID;
			
			#endregion
			using (SqlDataReader dataReader = SqlHelper.ExecuteReader(ConnectionString.ETMSRead, CommandType.StoredProcedure, commandName, parms))
			{
				if (dataReader.Read())
				{
					rec_Course = PopulateRes_CourseFromDataReader(dataReader);
				}
			}
			
			return rec_Course;
		}
		
		/// <summary>
		/// 根据参数获取对象列表（分页，可排序）
		/// </summary>
        public DataTable GetPagedList(int pageIndex, int pageSize, string sortExpression, string criteria, out int totalRecords)
		{
            string commandName = "dbo.Pr_Recommend_Course_GetPagedList";
            #region Parameters
            SqlParameter[] parms = SqlHelperParameterCache.GetCachedParameterSet(ConnectionString.ETMSRead, commandName);
            if (parms == null)
            {
                parms = new SqlParameter[] {
                    new SqlParameter("@PageIndex", SqlDbType.Int),
                    new SqlParameter("@PageSize", SqlDbType.Int),
                    new SqlParameter("@SortExpression", SqlDbType.NVarChar),
                    new SqlParameter("@Criteria", SqlDbType.NVarChar),
                    new SqlParameter("@ReturnValue", SqlDbType.Int, 4, ParameterDirection.ReturnValue, false, 0, 0, String.Empty, DataRowVersion.Default, null)
                };
                SqlHelperParameterCache.CacheParameterSet(ConnectionString.ETMSRead, commandName, parms);
            }

            parms[0].Value = pageIndex;
            parms[1].Value = pageSize;
            parms[2].Value = sortExpression;
            parms[3].Value = criteria;
            #endregion
            DataTable dt = SqlHelper.ExecuteDataset(ConnectionString.ETMSRead, CommandType.StoredProcedure, commandName, parms).Tables[0];
            totalRecords = (int)parms[4].Value;
            return dt;
        }        
		
		/// <summary>
		/// 从DataReader中读取数据到业务对象
		/// </summary>
		private Rec_Course PopulateRes_CourseFromDataReader(SqlDataReader reader)
		{
			Rec_Course rec_Course = new Rec_Course();
            int recommendIDIndex = reader.GetOrdinal("RecommendID");
            if (!reader.IsDBNull(recommendIDIndex))
            {
                rec_Course.RecommendID = reader.GetGuid(recommendIDIndex);
            }

            int courseIDIndex = reader.GetOrdinal("CourseID"); 
			if(!reader.IsDBNull(courseIDIndex))
			{
				rec_Course.CourseID= reader.GetGuid(courseIDIndex);
			}
            int isTopIndex = reader.GetOrdinal("IsTop");
            if (!reader.IsDBNull(isTopIndex))
            {
                rec_Course.IsTop = reader.GetBoolean(isTopIndex);
            }

            int sortIndex = reader.GetOrdinal("Sort");
            if (!reader.IsDBNull(sortIndex))
            {
                rec_Course.Sort = reader.GetInt32(sortIndex);
            }

            int createTimeIndex = reader.GetOrdinal("CreateTime");
            if (!reader.IsDBNull(createTimeIndex))
            {
                rec_Course.CreateTime = reader.GetDateTime(createTimeIndex);
            }

            int createUserIDIndex = reader.GetOrdinal("CreateUserID");
            if (!reader.IsDBNull(createUserIDIndex))
            {
                rec_Course.CreateUserID = reader.GetInt32(createUserIDIndex);
            }

            int createUserIndex = reader.GetOrdinal("CreateUser");
            if (!reader.IsDBNull(createUserIndex))
            {
                rec_Course.CreateUser = reader.GetString(createUserIndex);
            }

            int modifyTimeIndex = reader.GetOrdinal("ModifyTime");
            if (!reader.IsDBNull(modifyTimeIndex))
            {
                rec_Course.ModifyTime = reader.GetDateTime(modifyTimeIndex);
            }

            int modifyUserIndex = reader.GetOrdinal("ModifyUser");
            if (!reader.IsDBNull(modifyUserIndex))
            {
                rec_Course.ModifyUser = reader.GetString(modifyUserIndex);
            }

            int orgIDIndex = reader.GetOrdinal("OrgID");
            if (!reader.IsDBNull(orgIDIndex))
            {
                rec_Course.OrgID = reader.GetInt32(orgIDIndex);
            }
            return rec_Course; 
		}

        /// <summary>
        /// 获取最大的顺序号
        /// </summary>
        public int GetRecommendCourseMaxSort()
        {
            string commandName = "dbo.Pr_GetRecommendCourseMaxSort";
            int maxSort = 0;
            Object MaxSort = SqlHelper.ExecuteScalar(ConnectionString.ETMSRead, CommandType.StoredProcedure, commandName, null);
            if (MaxSort != null && MaxSort.ToString() != "")
            {
                maxSort = (int)MaxSort;
            }
            return maxSort;
        }
        /// <summary>
        /// 根据课程ID修改推荐课程排序号
        /// </summary>
        /// <param name="CourseID">课程ID</param>
        /// <param name="orderNum">排序号</param>
        public void UpdateOrderNumByCourseID(Guid CourseID, int orderNum)
        {
            
            string commandName = "dbo.Pr_Recommend_Course_UpdateOrderNum";
            #region Parameters
            SqlParameter[] parms = SqlHelperParameterCache.GetCachedParameterSet(ConnectionString.ETMSWrite, commandName);
            if (parms == null)
            {
                parms = new SqlParameter[] {
                    new SqlParameter("@CourseID", SqlDbType.UniqueIdentifier),
                    new SqlParameter("@OrderNum",SqlDbType.Int)
                };
                SqlHelperParameterCache.CacheParameterSet(ConnectionString.ETMSWrite, commandName, parms);
            }

            parms[0].Value = CourseID;
            parms[1].Value = orderNum;

            #endregion
            SqlHelper.ExecuteNonQuery(ConnectionString.ETMSWrite, CommandType.StoredProcedure, commandName, parms);
        }

        /// <summary>
        /// 获取点播课程列表
        /// </summary>
        /// <returns></returns>
        public DataTable GetDemandCoursePagedList(int pageIndex, int pageSize, string sortExpression, string criteria, int orgID, out int totalRecords)
        {
            string commandName = "[dbo].[Pr_Recommend_Course_GetDemandCoursePagedList]";
            #region Parameters
            SqlParameter[] parms = SqlHelperParameterCache.GetCachedParameterSet(ConnectionString.ETMSRead, commandName);
            if (parms == null)
            {
                parms = new SqlParameter[] {
                    new SqlParameter("@PageIndex", SqlDbType.Int),
                    new SqlParameter("@PageSize", SqlDbType.Int),
                    new SqlParameter("@SortExpression", SqlDbType.NVarChar),
                    new SqlParameter("@Criteria", SqlDbType.NVarChar),
                    new SqlParameter("@OrgID", SqlDbType.Int),
                    new SqlParameter("@ReturnValue", SqlDbType.Int, 4, ParameterDirection.ReturnValue, false, 0, 0, String.Empty, DataRowVersion.Default, null)
                };
                SqlHelperParameterCache.CacheParameterSet(ConnectionString.ETMSRead, commandName, parms);
            }

            parms[0].Value = pageIndex;
            parms[1].Value = pageSize;
            parms[2].Value = sortExpression;
            parms[3].Value = criteria;
            parms[4].Value = orgID;
            #endregion
            DataTable dt = SqlHelper.ExecuteDataset(ConnectionString.ETMSRead, CommandType.StoredProcedure, commandName, parms).Tables[0];
            totalRecords = (int)parms[5].Value;
            return dt;
        }

        /// <summary>
        /// 获取课程列表
        /// </summary>
        /// <returns></returns>
        public DataTable GetCoursePagedList(int pageIndex, int pageSize, string sortExpression, int typeid, int classid, string searchContent, int orgID, out int totalRecords)
        {
            string commandName = "[dbo].[Pr_Course_GetCoursePagedList]";
            #region Parameters
            SqlParameter[] parms = SqlHelperParameterCache.GetCachedParameterSet(ConnectionString.ETMSRead, commandName);
            if (parms == null)
            {
                parms = new SqlParameter[] {
                    new SqlParameter("@PageIndex", SqlDbType.Int),
                    new SqlParameter("@PageSize", SqlDbType.Int),
                    new SqlParameter("@SortExpression", SqlDbType.NVarChar),
                    new SqlParameter("@Key", SqlDbType.NVarChar),
                    new SqlParameter("@TypeId", SqlDbType.Int),
                    new SqlParameter("@ClassId", SqlDbType.Int),
                    new SqlParameter("@OrgID", SqlDbType.Int),
                    new SqlParameter("@ReturnValue", SqlDbType.Int, 4, ParameterDirection.ReturnValue, false, 0, 0, String.Empty, DataRowVersion.Default, null)
                };
                SqlHelperParameterCache.CacheParameterSet(ConnectionString.ETMSRead, commandName, parms);
            }

            parms[0].Value = pageIndex;
            parms[1].Value = pageSize;
            parms[2].Value = sortExpression;
            parms[3].Value = searchContent;
            parms[4].Value = typeid;
            parms[5].Value = classid;
            parms[6].Value = orgID;
            #endregion
            DataTable dt = SqlHelper.ExecuteDataset(ConnectionString.ETMSRead, CommandType.StoredProcedure, commandName, parms).Tables[0];
            totalRecords = (int)parms[7].Value;
            return dt;
        }
    }
}
